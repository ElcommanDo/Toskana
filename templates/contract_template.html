{%load static%}
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>نموذج عقد</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600&display=swap" rel="stylesheet">
  
  <style>
    body {
      font-family: 'cairo', sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #fff;
    }

    .container {
      max-width: 900px;
      margin: auto;
      border: 2px solid #000;
      padding: 20px;
    }

    .header img {
      width: 100%;
      height: auto;
      border-bottom: 2px solid #000;
    }

    .info-section {
      display: flex;
      justify-content: space-between;
      margin: 20px 0;
      font-size: 16px;
    }
  .info-section h3 {
    color: rgb(74, 72, 230);
  }
  .info-section p{
    color: rgb(241, 21, 6);
  }
  
    .info-box {
      width: 48%;
      border: 1px solid #000;
      padding: 10px;
      border-radius: 15px;
      margin: 10px;
    }

    .info-box p {
      margin: 5px 0;
    }

    .paragraph {
      border: 1px solid #000;
      padding: 15px;
      margin: 20px 0;
      font-size: 16px;
      line-height: 1.8;
      font-weight: bold;
      border-radius: 15px;
      color: rgb(71, 68, 206);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 15px;
      
      
    }

    table, th, td {
      border: 1px solid #000;
    }

    th{
        color: rgb(71, 68, 206);
    }
    th, td {
      padding: 10px;
      text-align: center;
    }

    .footer {
      margin-top: 10px;
      font-size: 16px;
    }

    .footer .delivery {
      margin-top: 10px;
    }

    .signature {
      margin-top: 10px;
      text-align: center;
    }

    .signature p {
      border-top: 1px solid #000;
      display: inline-block;
      padding-top: 5px;
    }
    .image-hover-container {
    position: relative;
    display: inline-block;
  }

  .image-hover-preview {
    display: none;
    position: absolute;
    top: 0;
    right: 100%;
    z-index: 10;
    width: 300px;
    border: 1px solid #ccc;
    background: white;
    padding: 10px;
    border-radius: 8px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
  }

  .image-hover-container:hover .image-hover-preview {
    display: block;
  }

  @media print {
  .header-image-section {
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
    color: #fff !important;
  }

  .header-image-section div {
    background-color: rgba(0, 0, 0, 0.7) !important;
    color: #fff !important;
  }

  .header-image-section img {
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }
}
/* Modal overlay */
.custom-modal-overlay {
  display: none;
  position: fixed;
  z-index: 999;
  inset: 0;
  background-color: rgba(0, 0, 0, 0.5);
  justify-content: center;
  align-items: center;
}

/* Modal box */
.custom-modal-content {
  background-color: #fff;
  border-radius: 10px;
  padding: 30px 20px;
  width: 400px;
  max-width: 95%;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  position: relative;
}

/* Close button */
.custom-close-button {
  position: absolute;
  top: 10px;
  left: 15px;
  font-size: 20px;
  cursor: pointer;
  border: none;
  background: none;
  color: #888;
}

/* Form fields */
.custom-modal-field {
  margin-bottom: 15px;
}

.custom-modal-field label {
  display: block;
  margin-bottom: 5px;
  color: #333;
}

.custom-modal-field input,
.custom-modal-field textarea {
  width: 100%;
  padding: 10px;
  border-radius: 6px;
  border: 1px solid #ccc;
  font-family: inherit;
}

/* Actions */
.custom-modal-actions {
  text-align: center;
  margin-top: 20px;
}

.custom-save-btn,
.custom-cancel-btn {
  padding: 10px 20px;
  border-radius: 6px;
  border: none;
  margin: 0 5px;
  cursor: pointer;
  font-size: 15px;
}

.custom-save-btn {
  background-color: #28a745;
  color: white;
}

.custom-cancel-btn {
  background-color: #6c757d;
  color: white;
}
  </style>
</head>
<body>

  <div class="container">
<!-- Header with Background Image and Paragraph Overlay and QR Code -->
<div class="header-image-section" style="
  position: relative;
  background-size: cover;
  background-position: center;
  height: 300px;
  border-radius: 10px;
  margin-bottom: 20px;
  color: #fff;
  overflow: hidden;
">

  <!-- Background Logo Image -->
  <img   class="view-btn cutom-open-modal" data-url="{% url 'update_contract_image' contract.pk %}"
  data-contract="{{ contract.client_name }}" src="{%if contract.contract_header_image%}{{contract.contract_header_image.url}}{%else%} {%static 'img/logo.jpg' %}{%endif%}" alt="Header" style="
  width: 100%;
  height: 100%;
  object-fit: cover;
  position: absolute;
  top: 0;
  left: 0;
  z-index: 1;
">

  <!-- QR Code Positioned in Top Right -->
  <img src="{% static 'img/frame.png' %}" alt="QR Code" style="
    position: absolute;
    top: 15px;
    right: 15px;
    width: 80px;
    height: 80px;
    border-radius: 10px;
    background: #fff;
    padding: 5px;
    z-index: 2;
  ">

  <!-- Paragraph Content -->
  <div style="
    background-color: rgba(0, 0, 0, 0.5);
    padding: 20px;
    border-radius: 10px;
    max-width: 50%;
    font-size: 22px;
    text-align: center;
    line-height: 1.8;
    position: relative;
    z-index: 2;
    top:80px;
    right: 200px;
  ">
    شركة توسكـانا للاثاث الراقى
    <br>
    Toskana for Furniture Company
    <br>
    عقد إتفاق - Agreement
  </div>
</div>



    <!-- Info Section -->
    <div class="info-section">
      <div class="info-box">
        <h3 style="margin-top: 2px;">طرف أول</h3>
        <p><strong>اسم العميل:</strong> {{contract.client_name}}</p>
        <p><strong>الرقم القومي:</strong> {{contract.client_id}}</p>
        <p><strong>العنوان:</strong> {{contract.client_address}}</p>
        
      </div>
      <div class="info-box">
        <h3 style="margin-top: 2px;">طرف ثانى</h3>
        <p><strong> شركة توسكانا</strong></p>
        <p><strong> ممثل المعرض:</strong> حسن همام ثابت</p>
        <p><strong>الرقم القومي:</strong> 29703212501476</p>
      </div>
    </div>

    <!-- Agreement Paragraph -->
    <div class="paragraph">
    انه فى يوم {{contract.contract_date|date:"Y-m-d"}} تم تحريرهذا العقد بين كل من طرف أول وطرف ثانى
    <br>
    يقر الطرفان باهليتهما للتعاقد واتفاقهما على ما يلى:
        <br>
        1- 
  يقوم الطرف الثانى بتصنيع كل كل ما هو بكشف بيان الاصناف والاسعار المرفق بالعقد للطرف الأول
  <br>
  2 -
  وسبق للطرف الثانى ان قام بحساب تكلفه تصنيع الاصناف المدرجه بكشف الأصناف والاسعار الملحق بالعقد
    </div>

    <!-- Products Table -->
    <table>
      <thead>
        <tr>
          <th> صوره المنتج</th>
          <th>الصنف</th>
          <th>الإجمالي</th>
          <th>ملاحظات</th>
        </tr>
      </thead>
      <tbody>
        {% for product in contract.products.all %}
        <tr>
          <tr>
            <td>
              <div class="image-hover-container">
                <img src="{% if product.product_image %}{{ product.product_image.url }}{% endif %}" width="90px">
                <div class="image-hover-preview">
                  <img src="{% if product.product_image %}{{ product.product_image.url }}{% endif %}" width="100%">
                </div>
              </div>
            </td>
         
          <td>{{ product.product_title }}</td>
          <td>{{ product.total_price }}</td>
          <td>{{ product.notes }}</td>
        </tr>
      {% endfor %}
        <tr>
          <td>المتبقى </td>
          <td>{{contract.remain}}</td>
          <td></td>
        </tr>

      </tbody>
    </table>
    {%if contract.deliverables.all%}
 <table>
      <thead>
        <tr>
          <th>تاريخ عمليه الدفع</th>
          <th>المبلغ المدفوع</th>
          <th>ملاحظات</th>
        </tr>
      </thead>
      <tbody>
        {% for obj in contract.deliverables.all %}
          <tr>
            <td>{{ obj.delivery_date|date:"Y-m-d" }}</td>
            <td>{{ obj.amount }}</td>
            <td>{{ obj.note }}</td>
          </tr>
        {% endfor %}
        
      </tbody>
    </table>
    {%endif%}

    <!-- Footer -->
    <div class="footer">
      <div class="delivery">
        <strong>الاستلام يوم:</strong> {{contract.recieve_date|date:"Y-m-d"}}
      </div>

      <div class="signature">
        
        <p>توقيع الطرف الثاني</p>

      </div>
     <div style="text-align: center;">
        <p> حَرر العقد من نسختين لكل طرف نسخه</p>
     </div>
    </div>

  </div>
<!-- Modal to change contract image -->
<div id="customModal" class="custom-modal-overlay">
  <div class="custom-modal-content">
    <form id="modalForm" method="POST" enctype="multipart/form-data" style="margin-top: 20px;">
      {% csrf_token %}
      <h2 style="text-align:center; margin-bottom: 20px;"> تغيير صوره الغلاف</h2>

      <div class="custom-modal-field">
        <label for="employee">صوره الغلاف:</label>
        <input style="width: 80%;" type="file" name="image" id="employee" required>
      </div>

      <div class="custom-modal-actions">
        <button type="submit" class="custom-save-btn">حفظ</button>
        <button type="button" class="custom-cancel-btn ">إلغاء</button>
        
  
      </div>
    </form>
  </div>
</div>

<script>
    document.querySelectorAll('.cutom-open-modal').forEach(button => {
      button.addEventListener('click', function (e) {
        e.preventDefault();
        const url = this.getAttribute('data-url');
        document.getElementById('modalForm').action = url;
        document.getElementById('customModal').style.display = 'flex';
      });
    });
    
    document.querySelectorAll('.custom-cancel-btn').forEach(button => {
      button.addEventListener('click', function () {
        document.getElementById('customModal').style.display = 'none';
      });
    });
    
    window.addEventListener('click', function(e) {
      const modal = document.getElementById('customModal');
      if (e.target === modal) {
        modal.style.display = 'none';
      }
    });

</script>

</body>
</html>
