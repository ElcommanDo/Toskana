<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      background: #f0f2f5;
      margin: 0;
      direction: rtl;
    }
    .navbar {
      background-color: #2c3e50;
      color: white;
      padding: 15px 30px;
      display: flex;
      justify-content: space-between;
    }
    .navbar a {
      color: white;
      text-decoration: none;
      font-weight: bold;
      margin-left: 20px;
    }
    .container {
      max-width: 1000px;
      margin: 30px auto;
      background: #fff;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
      color: #2c3e50;
      margin-bottom: 30px;
    }
    form {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-bottom: 40px;
    }
    label {
      font-weight: bold;
      margin-bottom: 5px;
    }
    input, select, textarea {
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 16px;
      width: 100%;
    }
    button {
      background-color: #27ae60;
      color: white;
      padding: 12px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #219150;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      padding: 15px;
      border-bottom: 1px solid #ddd;
      text-align: center;
    }
    th {
      background-color: #2980b9;
      color: white;
    }
    tr:hover {
      background-color: #f9f9f9;
    }

    .no-data {
      text-align: center;
      padding: 20px;
      color: #777;
    }
    .filters {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 25px;
        }

        .filters input,
        .filters select {
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ccc;
            width: 25%;
            
            
        }
        .filters div{
            display: inline-block;
          }
        .filters button {
            background: #3498db;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        
  </style>
</head>
<body>

<div class="navbar">
  <div>
    <a href="{% url 'home' %}">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
  </div>
  <div>
    <a href="{% url 'logout' %}">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a>
  </div>
</div>

<div class="container">
    
  <h1>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</h1>
  <form method="get" class="filters">
    <div>
        <label>Ù…Ù†:</label>
        <input type="date" name="start_date" value="{{ request.GET.start_date }}">
    </div>
    <div>
        <label>Ø¥Ù„Ù‰:</label>
        <input type="date" name="end_date" value="{{ request.GET.end_date }}">
    </div>
    <div>
        <label>Ø¨Ø­Ø« Ø¨Ø§Ù„Ø´Ù‡Ø±:</label>
        <select name="month">
            <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø´Ù‡Ø± --</option>
            <option value="1">ÙŠÙ†Ø§ÙŠØ±</option>
            <option value="2">ÙØ¨Ø±Ø§ÙŠØ±</option>
            <option value="3">Ù…Ø§Ø±Ø³</option>
            <option value="4">Ø£Ø¨Ø±ÙŠÙ„</option>
            <option value="5">Ù…Ø§ÙŠÙˆ</option>
            <option value="6">ÙŠÙˆÙ†ÙŠÙˆ</option>
            <option value="7">ÙŠÙˆÙ„ÙŠÙˆ</option>
            <option value="8">Ø£ØºØ³Ø·Ø³</option>
            <option value="9">Ø³Ø¨ØªÙ…Ø¨Ø±</option>
            <option value="10">Ø£ÙƒØªÙˆØ¨Ø±</option>
            <option value="11">Ù†ÙˆÙÙ…Ø¨Ø±</option>
            <option value="12">Ø¯ÙŠØ³Ù…Ø¨Ø±</option>
        </select>
    </div>
    <button type="submit"><i class="fas fa-search"></i> Ø¨Ø­Ø«</button>
</form>
<h3>Ø¥Ø¶Ø§ÙÙ‡ Ù…ØµØ±ÙˆÙØ§Øª Ø¬Ø¯ÙŠØ¯Ø©</h3>
  <form method="post">

    {% csrf_token %}
    <div>
      <label for="description">ÙˆØµÙ Ø§Ù„Ù…ØµØ±ÙˆÙ</label>
      <textarea id="description" name="description" required></textarea>
    </div>
    <div>
      <label for="amount">Ø§Ù„Ù…Ø¨Ù„Øº (Ø¬.Ù…)</label>
      <input type="number" id="amount" name="amount" step="0.01" required>
    </div>
    <div>
      <label for="source">Ø§Ù„Ø¬Ù‡Ø©</label>
      <input type="text" id="source" name="source" required>
    </div>
    <button type="submit">Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ</button>
  </form>

  <h2>Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h2>
  <table>
    <thead>
      <tr>
        <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
        <th>Ø§Ù„ÙˆØµÙ</th>
        <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
        <th>Ø§Ù„Ø¬Ù‡Ø©</th>
        <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>

      </tr>
    </thead>
    <tbody>
      {% if expensses %}
        {% for expense in expensses %}
        <tr>
          <td>{{ expense.created_at }}</td>
          <td>{{ expense.description }}</td>
          <td>{{ expense.amount }} Ø¬.Ù…</td>
          <td>{{ expense.direct_to }}</td>
          <td>
            <button style="background-color: rgb(236, 236, 102);" onclick="openEditModal('{{ expense.id }}', '{{ expense.description }}', '{{ expense.amount }}', '{{ expense.direct_to }}')">âœï¸</button>
            {% if request.user.is_superuser%}
            <button style="background-color: rgb(233, 7, 7);" onclick="openDeleteModal('{{ expense.id }}')">ğŸ—‘ï¸</button>
            {%endif%}
          </td>
          
        </tr>
        {% endfor %}
      {% else %}
        <tr>
          <td colspan="4" class="no-data">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ØµØ±ÙˆÙØ§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</td>
        </tr>
      {% endif %}
    </tbody>
      {% if expensses %}
    <tfoot>
      <tr>
        <td colspan="2"><strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</strong></td>
        <td colspan="2">
          <strong>
            {{total}} Ø¬.Ù…
          </strong>
        </td>
      </tr>
    </tfoot>
    {% endif %}
  </table>
<!-- Edit Modal -->
<div id="editModal" style="display:none; position:fixed; top:0; right:0; bottom:0; left:0; background-color:rgba(0,0,0,0.5); z-index:999; align-items:center; justify-content:center;">
  <div style="background:#fff; padding:20px; border-radius:10px; width:300px;">
    <h3>ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…ØµØ±ÙˆÙ</h3>
    <form method="post" action="{%url 'update_expense' %}">
      {% csrf_token %}
      <input type="hidden" id="edit-id" name="id">
      <label>Ø§Ù„ÙˆØµÙ:</label>
      <textarea id="edit-description" name="description" required></textarea>
      <label>Ø§Ù„Ù…Ø¨Ù„Øº:</label>
      <input type="number" id="edit-amount" name="amount" required>
      <label>Ø§Ù„Ø¬Ù‡Ø©:</label>
      <input type="text" id="edit-source" name="source" required>
      <button type="submit">ØªØ­Ø¯ÙŠØ«</button>
      <button type="button" onclick="closeEditModal()">Ø¥Ù„ØºØ§Ø¡</button>
    </form>
  </div>
</div>

<!-- Delete Modal -->
<div id="deleteModal" style="display:none; position:fixed; top:0; right:0; bottom:0; left:0; background-color:rgba(0,0,0,0.5); z-index:999; align-items:center; justify-content:center;">
  <div style="background:#fff; padding:20px; border-radius:10px; width:300px; text-align:center;">
    <h3>ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù</h3>
    <p>Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…ØµØ±ÙˆÙØŸ</p>
    <form method="post" action="{%url 'delete_expense' %}">
      {% csrf_token %}
      <input type="hidden" id="delete-id" name="id">
      <button type="submit">Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù</button>
      <button type="button" onclick="closeDeleteModal()">Ø¥Ù„ØºØ§Ø¡</button>
    </form>
  </div>
</div>

</div>
<script>
  function openEditModal(id, description, amount, source) {
    document.getElementById('edit-id').value = id;
    document.getElementById('edit-description').value = description;
    document.getElementById('edit-amount').value = amount;
    document.getElementById('edit-source').value = source;
    document.getElementById('editModal').style.display = 'flex';
  }

  function closeEditModal() {
    document.getElementById('editModal').style.display = 'none';
  }

  function openDeleteModal(id) {
    document.getElementById('delete-id').value = id;
    document.getElementById('deleteModal').style.display = 'flex';
  }

  function closeDeleteModal() {
    document.getElementById('deleteModal').style.display = 'none';
  }
</script>

</body>
</html>
